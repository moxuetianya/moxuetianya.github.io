<!doctype html>
<html class="not-ready lg:text-base overflow-y-scroll scroll-pt-14" lang="en">

<head prefix="og: https://ogp.me/ns# article: https://ogp.me/ns/article#">
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="generator" content="Zola" />
  <title>使用tshark进行pcap和pcapng的转换</title>
  <meta property="og:title" content="使用tshark进行pcap和pcapng的转换" />
  <meta property="og:url" content="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/" />
  <link rel="canonical" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-08-12T18:53:51+08:00" />
  <meta property="article:tag" content="tshark" />
  <meta property="article:tag" content="pcap" />
  <!-- Begin Head inject -->
  
  <!-- End Head inject -->
  <link rel="stylesheet" href="https://blog.moxuetianya.com/main.min.css?h=fc65ba308cf36d3ba82c" />
  <style>
  :root{--bg: #f4f4f5; --header: #e4e4e7; color-scheme: light;}
  :root.dark{--bg: #18181b; --header: #27272a; color-scheme: dark;}
  </style>
  <meta name="theme-color" data-light="#e4e4e7" data-dark="#27272a" content="#e4e4e7" />
  <link rel="icon" type="image/x-icon" sizes="16x16" href="https://blog.moxuetianya.com/favicon.ico" />
  <link rel="apple-touch-icon" type="image/png" href="https://blog.moxuetianya.com/apple-touch-icon.png?h=58bee300054c5308feb3" />
  <link rel="icon" type="image/png" href="https://blog.moxuetianya.com/android-icon.png?h=8d80ec95446bd2c36826" />
  <script src="https://blog.moxuetianya.com/js/linkita.min.js?h=1dd3ed42fc674277bc34"></script>
  <script src="https://blog.moxuetianya.com/js/linkita-search.min.js?h=698547b4b081d012c661"></script>
  <!-- Begin Head End inject -->
  
  <!-- End Head End inject -->
</head>

<body class="text-black duration-100 ease-out bg-[var(--bg)] dark:text-white">
  <!-- Header -->
<header class="bg-[var(--header)] fixed top-0 z-40 mx-auto min-h-[3.25rem] w-full header-icons">
  <div class="mx-auto w-full max-w-4xl p-2.5 lg:flex lg:justify-between">
    <div class="flex justify-between">
      <div class="flex items-center min-h-8">
        <button type="button" title="Go to home page" accesskey="!"
          onclick="window.location.href='https://blog.moxuetianya.com/';"
          class="btn-home h-6 w-6 shrink-0 cursor-pointer text-[0] bg-center bg-no-repeat bg-cover [background-image:var(--icon-home)] dark:invert"
        ></button>
        <button type="button" title="Switch color scheme" accesskey="$"
          onclick="window.linkita.toggleDarkMode();" ondblclick="window.linkita.resetDarkMode();"
          class="btn-dark ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0] bg-center bg-no-repeat bg-cover dark:invert [background-image:var(--icon-theme-dark)] dark:[background-image:var(--icon-theme-light)]"
        ></button>
        <button type="button" title="Search" accesskey="/"
          onclick="window.linkita.toggleSearch();"
          class="btn-search ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0] bg-center bg-no-repeat bg-cover [background-image:var(--icon-search)] dark:invert"
        ></button>
        <script>window.linkita.initSearchButton({ scripts: ["https://blog.moxuetianya.com/elasticlunr.min.js", "https://blog.moxuetianya.com/search_index.en.js"] });</script>
      </div>
    </div>
  </div>
</header>

  <!-- Begin Body Start inject -->
  
  <!-- End Body Start inject -->
  <main class="prose prose-neutral relative mx-auto min-h-[calc(100%-4rem)]
    max-w-3xl break-words px-4 pb-12 pt-28 lg:pt-32 dark:prose-invert prose-pre:rounded-lg prose-img:rounded-lg">
      <!-- Search -->
<div id="linkita-search-wrapper" class="hidden">
  <ul id="linkita-search-results"></ul>
</div>

    
<article>
  <!-- Begin Page Start inject -->
  
  <!-- End Page Start inject -->

  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">使用tshark进行pcap和pcapng的转换</h1>
    <!-- Page Info -->
<div class="text-sm antialiased opacity-80"><time
      datetime="2025-08-12T18:53:51+08:00">2025-08-12</time><span
        class="mx-1">&middot;</span><time
    datetime="PT0H5M0S">5&nbsp;min</time>
</div>

  </header>
  <!-- TOC -->
<div class="block-bg mb-12 rounded-lg p-2 text-lg">
  <details>
    <summary class="select-none py-0.5 lg:py-1 pl-4" accesskey="=">
      <span class="cursor-pointer">Table of Contents</span>
    </summary>
    <div class="px-2">
      <ul>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#tshark-jian-jie">tshark 简介</a>
        </li>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#pcap">pcap</a>
          <ul>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#tshark-zhuan-huan-pcapng-wei-pcap">tshark 转换pcapng 为pcap</a>
            </li>
          </ul>
        </li>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#tshark-zhong-de-chang-yong-can-shu">tshark 中的常用参数</a>
        </li>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#tshark-da-yin-pcap">tshark 打印pcap</a>
          <ul>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#cha-kan-qing-qiu-mu-biao-xin-xi">查看请求目标信息</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#cha-kan-diu-bao-dai-kuan-tun-tu-yan-chi">查看丢包、带宽、吞吐、延迟</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#ji-suan-diu-bao-qing-kuang">计算丢包情况</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#ji-suan-shang-xing-dai-kuan">计算上行带宽</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#ji-suan-tcp-rtt">计算 TCP RTT</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#fen-xi-tcp-stream-id-wei-0-de-chuan-shu-dai-kuan">分析 tcp.stream id 为 0 的传输带宽</a>
            </li>
          </ul>
        </li>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/08/pcap和pcapng的转换/#can-kao">参考</a>
        </li>
      </ul>
    </div>
  </details>
</div>

  <!-- Content -->
  <section><h1 id="tshark-jian-jie">tshark 简介</h1>
<p>tshark就是wireshark的命令行之一。WireShark的功能基本都有，还能组合grep/awk等编程处理分析抓包文件。</p>
<p>TShark是一个网络分析工具。它能帮你在实时网络中捕获数据包，或是从预先保存好的捕获文件中读取数据包，或是打印出这些数据包的解码形式到标准输出，再或是把数据包写入到一个文件中。TShark的本地捕获文件格式是pcapng格式，这种pcapng格式也被wireshark和多种其他工具使用。</p>
<p>Wireshark除了能够手动的分析报文之外，还额外的提供了几个命令行工具，方便开发者日常的报文处理需求，比如批量的合并以及编辑报文。这几个命令都是安装wireshark之后能够直接使用的，同时有的有对应的wireshark GUI 的操作。这些命令分别有tshark、tcpdump、capinfos、dumpcap、text2cap、editcap、reordercap、rawshark、mergecap、pcapfix(需单独安装)。</p>
<ul>
<li>tshark：基于终端的Wireshark</li>
<li>tcpdump：使用“tcpdump”捕获以便使用Wireshark查看</li>
<li>dumpcap：捕获“dumpcap”以便使用Wireshark查看</li>
<li>capinfos：打印有关捕获文件的信息</li>
<li>rawshark：转储和分析网络流量。</li>
<li>editcap：编辑捕获文件</li>
<li>mergecap：将多个捕获文件合并为一个</li>
<li>text2pcap：将ASCII hexdumps转换为网络捕获</li>
<li>reordercap：重新排序捕获文件</li>
<li>pcapfix: 修复pcap文件</li>
</ul>
<h1 id="pcap">pcap</h1>
<p>Wireshark默认的存储方式是pcap格式，最新版本的wireshark默认存储方式是pcapng。ng是next generation 的缩写，pcap和pcapng格式文件有是存在一定的差异。</p>
<p>pcap报文文件结构示意图 https://img1.kiosk007.top/static/images/tshark/pcap_file_format.png</p>
<ul>
<li>Global Header是整个文件的文件头，包含文件格式标识，pcap格式版本号等文件指示信息。</li>
<li>Packet Header是每一片数据报文的头部信息，这些信息都是在形成pcap 报文的过程中由抓包软件wireshark添加的额外信息，例如报文捕获时间等。</li>
<li>Packet Data是抓取通信过程中的实际数据，包括协议数据和内容数据。</li>
<li>Wireshark 中对 Global Header 的定义</li>
</ul>
<pre data-lang="c" style="background-color:#2b303b;color:#c0c5ce;" class="language-c "><code class="language-c" data-lang="c"><span style="color:#b48ead;">typedef struct</span><span> pcap_hdr_s {
</span><span>    guint32 magic_number;   </span><span style="color:#65737e;">/* magic number */
</span><span>    guint16 version_major;  </span><span style="color:#65737e;">/* major version number */
</span><span>    guint16 version_minor;  </span><span style="color:#65737e;">/* minor version number */
</span><span>    gint32  thiszone;       </span><span style="color:#65737e;">/* GMT to local correction */
</span><span>    guint32 sigfigs;        </span><span style="color:#65737e;">/* accuracy of timestamps */
</span><span>    guint32 snaplen;        </span><span style="color:#65737e;">/* max length of captured packets, in octets */
</span><span>    guint32 network;        </span><span style="color:#65737e;">/* data link type */
</span><span>} pcap_hdr_t;
</span></code></pre>
<p>Wireshark 中对 Packet Header 的定义</p>
<pre data-lang="c" style="background-color:#2b303b;color:#c0c5ce;" class="language-c "><code class="language-c" data-lang="c"><span style="color:#b48ead;">typedef struct</span><span> pcaprec_hdr_s {
</span><span>    guint32 ts_sec;         </span><span style="color:#65737e;">/* timestamp seconds */
</span><span>    guint32 ts_usec;        </span><span style="color:#65737e;">/* timestamp microseconds */
</span><span>    guint32 incl_len;       </span><span style="color:#65737e;">/* number of octets of packet saved in file */
</span><span>    guint32 orig_len;       </span><span style="color:#65737e;">/* actual length of packet */
</span><span>} pcaprec_hdr_t;
</span></code></pre>
<h2 id="tshark-zhuan-huan-pcapng-wei-pcap">tshark 转换pcapng 为pcap</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">tshark -F</span><span> pcap</span><span style="color:#bf616a;"> -r</span><span> origin.pcapng</span><span style="color:#bf616a;"> -w</span><span> output.pcap
</span></code></pre>
<h1 id="tshark-zhong-de-chang-yong-can-shu">tshark 中的常用参数</h1>
<ul>
<li>-o ${key:value} : 配置首选项中的settings, 一般可配置显示时间戳、是否相关seq number，或者TLS、WPA 解密等。
<img src="https://blog.moxuetianya.com/2025/08/pcap%E5%92%8Cpcapng%E7%9A%84%E8%BD%AC%E6%8D%A2/2025-08-13-09-43-10.png" alt="" /></li>
<li>-z ${statistics} : 集各种类型的统计信息, 这里面有一些信息是很有用的，如专家信息、时序统计飞行中的报文、时序丢包都需要这个参数
<img src="https://blog.moxuetianya.com/2025/08/pcap%E5%92%8Cpcapng%E7%9A%84%E8%BD%AC%E6%8D%A2/2025-08-13-09-45-04.png" alt="" /></li>
</ul>
<p>其他参数介绍</p>
<pre data-lang="text" style="background-color:#2b303b;color:#c0c5ce;" class="language-text "><code class="language-text" data-lang="text"><span># 抓包接口类
</span><span>-i 设置抓包的网络接口，不设置则默认为第一个非自环接口。
</span><span>-D 列出当前存在的网络接口。在不了解OS所控制的网络设备时，一般先用“tshark -D”查看网络接口的编号以供-i参数使用。
</span><span>-f 设定抓包过滤表达式（capture filter expression）。抓包过滤表达式的写法雷同于tcpdump
</span><span>-s 设置每个抓包的大小，默认为65535，多于这个大小的数据将不会被程序记入内存、写入文件
</span><span>-p 设置网络接口以非混合模式工作，即只关心和本机有关的流量
</span><span>
</span><span># 停止抓包参数
</span><span>-c 抓取的packet数，在处理一定数量的packet后，停止抓取，程序退出。
</span><span>-a 设置tshark抓包停止向文件书写的条件，事实上是tshark在正常启动之后停止工作并返回的条件。条件写为test:value的形式，如“-a duration:5”表示tshark启动后在5秒内抓包然后停止；“-a filesize:10”表示tshark在输出文件达到10kB后停止；“-a files:n”表示tshark在写满n个文件后停止。
</span><span>
</span><span># 处理类
</span><span>-R 设置读取（显示）过滤表达式（read filter expression）。不符合此表达式的流量同样不会被写入文件。
</span><span>-n 禁止所有地址名字解析（默认为允许所有）。
</span><span>-N 启用某一层的地址名字解析。“m”代表MAC层，“n”代表网络层，“t”代表传输层，“C”代表当前异步DNS查找。如果-n和-N参数同时存在，-n将被忽略。如果-n和-N参数都不写，则默认打开所有地址名字解析。
</span><span>-d 将指定的数据按有关协议解包输出。如要将tcp 8888端口的流量按http解包，应该写为“-d tcp.port==8888,http”。注意选择子和解包协议之间不能留空格。
</span><span>
</span><span># 输出类
</span><span>-w 设置raw数据的输出文件。这个参数不设置，tshark将会把解码结果输出到stdout。“-w-”表示把raw输出到stdout。如果要把解码结果输出到文件，使用重定向“&gt;”而不要-w参数。
</span><span>-F 设置输出raw数据的格式，默认为libpcap。“tshark -F”会列出所有支持的raw格式。
</span><span>-V 设置将解码结果的细节输出，否则解码结果仅显示一个packet一行的summary。
</span><span>-x 设置在解码输出结果中，每个packet后面以HEX dump的方式显示具体数据。
</span><span>-T 设置解码结果输出的格式，包括text,ps,psml和pdml，默认为text。
</span><span>-E: -E &lt;fieldsoption&gt;=&lt;value&gt;如果-T fields选项指定，使用-E来设置一些属性，比如
</span><span>　　　　header=y|n
</span><span>　　　　separator=/t|/s|&lt;char&gt;
</span><span>　　　　occurrence=f|l|a
</span><span>　　　　aggregator=,|/s|&lt;char&gt;
</span><span>-t 设置解码结果的时间格式。“ad”表示带日期的绝对时间，“a”表示不带日期的绝对时间，“r”表示从第一个包到现在的相对时间，“d”表示两个相邻包之间的增量时间（delta）。
</span><span>-S 在向raw文件输出的同时，将解码结果打印到控制台。
</span><span>-l 在处理每个包时即时刷新输出。
</span><span>-X 扩展项。
</span><span>-q 设置安静的stdout输出（例如做统计时）
</span><span>-z 设置统计参数。
</span><span>
</span><span># 其他
</span><span>-h 显示命令行帮助。
</span><span>-v 显示tshark的版本信息。
</span><span>-o 重载选项
</span></code></pre>
<h1 id="tshark-da-yin-pcap">tshark 打印pcap</h1>
<p>我们通过tcpdump或者wireshark抓到 pcap 文件，接下来就可以利用 tshark 这个强大的命令行工具进行抓包。其中 -o的几个选项可以指定 ssl 解密（需要sslkeylog），-T 指定输出格式，-e 指定都需要输出哪些字段（字段列表参考 https://www.wireshark.org/docs/dfref/）。输出是将每个Package中指定的字段输出。</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">tshark -o</span><span> ssl.keylog_file:./sslkeylog.txt \
</span><span style="color:#bf616a;">-o </span><span>&quot;</span><span style="color:#a3be8c;">ssl.desegment_ssl_records: TRUE</span><span>&quot; \
</span><span style="color:#bf616a;">-o </span><span>&quot;</span><span style="color:#a3be8c;">ssl.desegment_ssl_application_data: TRUE</span><span>&quot; \
</span><span style="color:#bf616a;">-e</span><span> ssl.handshake.ciphersuite \</span><span style="background-color:#bf616a;color:#2b303b;">  </span><span>
</span><span style="color:#bf616a;">-e</span><span> tcp.analysis.zero_window \
</span><span style="color:#bf616a;">-e</span><span> http.host \
</span><span style="color:#bf616a;">-e</span><span> dns.time \
</span><span style="color:#bf616a;">-e</span><span> tcp.flags.urg \
</span><span style="color:#bf616a;">-e</span><span> http.request.line \
</span><span style="color:#bf616a;">-e</span><span> dns.qry.name \
</span><span style="color:#bf616a;">-e</span><span> ip.version \
</span><span style="color:#bf616a;">-e</span><span> tcp.analysis.window_full \
</span><span style="color:#bf616a;">-e</span><span> ipv6.dst \
</span><span style="color:#bf616a;">-e</span><span> http.request.version \
</span><span style="color:#bf616a;">-e</span><span> udp.dstport \
</span><span style="color:#bf616a;">-e</span><span> dns.flags.response \
</span><span>.... \
</span><span style="color:#bf616a;">-T</span><span> json</span><span style="color:#bf616a;"> -r </span><span>&quot;</span><span style="color:#a3be8c;">./capturedump.pcap</span><span>&quot;
</span></code></pre>
<p>其他样例</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">//打印http协议流相关信息
</span><span style="color:#bf616a;">tshark -s</span><span> 512</span><span style="color:#bf616a;"> -i</span><span> eth0</span><span style="color:#bf616a;"> -n -f </span><span>&#39;</span><span style="color:#a3be8c;">tcp dst port 80</span><span>&#39;</span><span style="color:#bf616a;"> -Y </span><span>&#39;</span><span style="color:#a3be8c;">http.host and http.request.uri</span><span>&#39;</span><span style="color:#bf616a;"> -T</span><span> fields</span><span style="color:#bf616a;"> -e</span><span> http.host</span><span style="color:#bf616a;"> -e</span><span> http.request.uri</span><span style="color:#bf616a;"> -l
</span><span style="color:#bf616a;">//实时打印当前mysql查询语句
</span><span style="color:#bf616a;">tshark -s</span><span> 512</span><span style="color:#bf616a;"> -i</span><span> eth0</span><span style="color:#bf616a;"> -n -f </span><span>&#39;</span><span style="color:#a3be8c;">tcp dst port 3306</span><span>&#39;</span><span style="color:#bf616a;"> -Y </span><span>&#39;</span><span style="color:#a3be8c;">mysql.query</span><span>&#39;</span><span style="color:#bf616a;"> -T</span><span> fields</span><span style="color:#bf616a;"> -e</span><span> mysql.query
</span><span style="color:#bf616a;">//解析MySQL协议
</span><span style="color:#bf616a;">tshark -r</span><span> ./mysql-compress.cap</span><span style="color:#bf616a;"> -o</span><span> tcp.calculate_timestamps:true \
</span><span style="color:#bf616a;">-T</span><span> fields</span><span style="color:#bf616a;"> -e</span><span> mysql.caps.cp</span><span style="color:#bf616a;"> -e</span><span> frame.number \
</span><span style="color:#bf616a;">-e</span><span> frame.time_epoch</span><span style="color:#bf616a;">  -e</span><span> frame.time_delta_displayed  \
</span><span style="color:#bf616a;">-e</span><span> ip.src</span><span style="color:#bf616a;"> -e</span><span> tcp.srcport</span><span style="color:#bf616a;"> -e</span><span> tcp.dstport</span><span style="color:#bf616a;"> -e</span><span> ip.dst \
</span><span style="color:#bf616a;">-e</span><span> tcp.time_delta</span><span style="color:#bf616a;"> -e</span><span> frame.time_delta_displayed \
</span><span style="color:#bf616a;">-e</span><span> tcp.stream</span><span style="color:#bf616a;"> -e</span><span> tcp.len</span><span style="color:#bf616a;"> -e</span><span> mysql.query
</span><span style="color:#bf616a;">//抓取详细SQL语句,</span><span> 快速确认client发过来的具体SQL内容：
</span><span style="color:#bf616a;">sudo</span><span> tshark</span><span style="color:#bf616a;"> -i</span><span> any</span><span style="color:#bf616a;"> -f </span><span>&#39;</span><span style="color:#a3be8c;">port 3306</span><span>&#39;</span><span style="color:#bf616a;"> -s</span><span> 0</span><span style="color:#bf616a;"> -l -w</span><span> - |</span><span style="color:#bf616a;">strings
</span><span style="color:#bf616a;">sudo</span><span> tshark</span><span style="color:#bf616a;"> -i</span><span> eth0</span><span style="color:#bf616a;"> -d</span><span> tcp.port==3306,mysql</span><span style="color:#bf616a;"> -T</span><span> fields</span><span style="color:#bf616a;"> -e</span><span> mysql.query &#39;</span><span style="color:#a3be8c;">port 3306</span><span>&#39;
</span><span style="color:#bf616a;">dfaf
</span><span style="color:#bf616a;">sudo</span><span> tshark</span><span style="color:#bf616a;"> -i</span><span> eth0</span><span style="color:#bf616a;"> -Y </span><span>&quot;</span><span style="color:#a3be8c;">ip.addr==11.163.182.137</span><span>&quot;</span><span style="color:#bf616a;"> -d</span><span> tcp.port==3306,mysql</span><span style="color:#bf616a;"> -T</span><span> fields</span><span style="color:#bf616a;"> -e</span><span> mysql.query &#39;</span><span style="color:#a3be8c;">port 3306</span><span>&#39;
</span><span style="color:#bf616a;">sudo</span><span> tshark</span><span style="color:#bf616a;"> -i</span><span> eth0</span><span style="color:#bf616a;"> -Y </span><span>&quot;</span><span style="color:#a3be8c;">tcp.srcport==62877</span><span>&quot;</span><span style="color:#bf616a;"> -d</span><span> tcp.port==3001,mysql</span><span style="color:#bf616a;"> -T</span><span> fields</span><span style="color:#bf616a;"> -e</span><span> tcp.srcport</span><span style="color:#bf616a;"> -e</span><span> mysql.query &#39;</span><span style="color:#a3be8c;">port 3001</span><span>&#39;
</span></code></pre>
<h2 id="cha-kan-qing-qiu-mu-biao-xin-xi">查看请求目标信息</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">tshark -r</span><span> wechat.pcap</span><span style="color:#bf616a;"> -o </span><span>&#39;</span><span style="color:#a3be8c;">gui.column.format:&quot;Source Net Addr&quot;,&quot;%uns&quot;,&quot;Dest Net Addr&quot;, &quot;%und&quot;</span><span>&#39;</span><span style="color:#bf616a;"> -Y </span><span>&quot;</span><span style="color:#a3be8c;">ip</span><span>&quot; | </span><span style="color:#bf616a;">sort </span><span>| </span><span style="color:#bf616a;">uniq
</span></code></pre>
<h2 id="cha-kan-diu-bao-dai-kuan-tun-tu-yan-chi">查看丢包、带宽、吞吐、延迟</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">//</span><span> 统计 ip 情况
</span><span style="color:#bf616a;">tshark -r</span><span> wechat.pcap</span><span style="color:#bf616a;"> -q -z</span><span> conv,ip
</span><span>
</span><span style="color:#bf616a;">//</span><span> 跟踪一条流打印 16进制数据
</span><span style="color:#bf616a;">tshark -r</span><span> wechat.pcap</span><span style="color:#bf616a;"> -q -z </span><span>&quot;</span><span style="color:#a3be8c;">follow,tcp,hex,0</span><span>&quot; 
</span></code></pre>
<h2 id="ji-suan-diu-bao-qing-kuang">计算丢包情况</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">tshark -r</span><span> wechat.pcap</span><span style="color:#bf616a;"> -q </span><span>\
</span><span style="color:#bf616a;"> -z</span><span> io,stat,1,&quot;</span><span style="color:#a3be8c;">COUNT(tcp.analysis.retransmission) tcp.analysis.retransmission</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">COUNT(tcp.analysis.fast_retransmission) tcp.analysis.fast_retransmission</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">COUNT(tcp.analysis.duplicate_ack) tcp.analysis.duplicate_ack</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">COUNT(tcp.analysis.lost_segment) tcp.analysis.lost_segment</span><span>&quot;
</span></code></pre>
<h2 id="ji-suan-shang-xing-dai-kuan">计算上行带宽</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">tshark -o</span><span> tcp.desegment_tcp_streams:TRUE</span><span style="color:#bf616a;"> -n </span><span>\
</span><span style="color:#bf616a;">  -q -r</span><span>  ./wechat.pcap \
</span><span style="color:#bf616a;">  -z</span><span> io,stat,99999999,&quot;</span><span style="color:#a3be8c;">BYTES()(ip.src!=10.0.0.0/8 and ip.src!=172.16.0.0/12 and ip.src!=192.168.0.0/16)</span><span>&quot;
</span></code></pre>
<h2 id="ji-suan-tcp-rtt">计算 TCP RTT</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">tshark -o</span><span> tcp.desegment_tcp_streams:TRUE</span><span style="color:#bf616a;"> -n </span><span>\
</span><span style="color:#bf616a;">  -q -r</span><span>  ./wechat.pcap</span><span style="color:#bf616a;">  -z </span><span>\
</span><span>  io,stat,99999999,&quot;</span><span style="color:#a3be8c;">AVG(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt</span><span>&quot;
</span></code></pre>
<h2 id="fen-xi-tcp-stream-id-wei-0-de-chuan-shu-dai-kuan">分析 tcp.stream id 为 0 的传输带宽</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">tshark -o</span><span> tcp.desegment_tcp_streams:FALSE</span><span style="color:#bf616a;"> -n </span><span>\
</span><span style="color:#bf616a;">  -q -r</span><span> wechat.pcapng</span><span style="color:#bf616a;"> -z</span><span> io,stat,1,&quot;</span><span style="color:#a3be8c;">BYTES()tcp.stream==0</span><span>&quot;
</span></code></pre>
<h1 id="can-kao">参考</h1>
<p><a href="https://kiosk007.top/post/%E7%8E%A9%E8%BD%AC-tshark-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/">玩转tshark命令行工具</a></p>
</section>
  <hr />
  <!-- Post Taxonomies -->
<footer class="mt-12 flex flex-col" tabindex="-1" accesskey="_">
  <div class="mb-2 flex flex-wrap">
    <span class="block-bg mb-1.5 mr-1.5 rounded-lg px-5 py-1.5">Tags</span>
    
    <a
      class="block-bg block-hover mb-1.5 mr-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://blog.moxuetianya.com/tags/tshark/">tshark</a>
    
    <a
      class="block-bg block-hover mb-1.5 mr-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://blog.moxuetianya.com/tags/pcap/">pcap</a>
    
  </div>
</footer>

  <!-- Post Nav -->
<nav class="block-bg mt-12 flex flex-wrap rounded-lg text-lg">
  <a
    class="block-hover-mask flex min-w-[50%] grow items-center rounded-l-md p-6 pr-3 font-semibold no-underline"
    href="https://blog.moxuetianya.com/2025/08/linxu DNS systemd-resolved/" accesskey=","
    ><span class="mr-1.5">&#8249;</span><span>linxu DNS systemd-resolved</span></a>
  <a
    class="block-hover-mask ml-auto flex min-w-[50%] grow items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline"
    href="https://blog.moxuetianya.com/2025/08/dns报文格式/" accesskey="."
    ><span>dns报文格式</span><span class="ml-1.5">&#8250;</span></a>
</nav>

  <!-- Begin Page End inject -->
  
  <!-- End Page End inject -->
</article>

  </main>
  <!-- Footer -->
<footer class="mx-auto flex lg:mt-5 max-w-3xl flex-wrap items-center px-4 py-3 text-sm opacity-60">
  <div class="mr-auto basis-full lg:basis-1/2">
  © <time datetime="2025">2025</time> moxuetianya
  </div>
  <div class="flex basis-full lg:basis-1/2 lg:justify-end">
    <span class="mr-6 lg:ml-6">
      <a class="link" href="https://www.getzola.org/" target="_blank">Powered by Zola</a>
    </span>
    <a class="link" href="https://www.getzola.org/themes/linkita/" target="_blank">&#9998; Linkita</a>
  </div>
  <!-- Begin Footer inject -->
  
  <!-- End Footer inject -->
</footer>

  

  <!-- Begin Body End inject -->
  
  <!-- End Body End inject -->
</body>

</html>
