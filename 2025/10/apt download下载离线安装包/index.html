<!doctype html>
<html class="not-ready lg:text-base overflow-y-scroll scroll-pt-14" lang="en">

<head prefix="og: https://ogp.me/ns# article: https://ogp.me/ns/article#">
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="generator" content="Zola" />
  <title>apt download下载离线安装包</title>
  <meta property="og:title" content="apt download下载离线安装包" />
  <meta property="og:url" content="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/" />
  <link rel="canonical" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-10-23T13:29:40+08:00" />
  <meta property="article:tag" content="apt" />
  <!-- Begin Head inject -->
  
  <!-- End Head inject -->
  <link rel="stylesheet" href="https://blog.moxuetianya.com/main.min.css?h=fc65ba308cf36d3ba82c" />
  <style>
  :root{--bg: #f4f4f5; --header: #e4e4e7; color-scheme: light;}
  :root.dark{--bg: #18181b; --header: #27272a; color-scheme: dark;}
  </style>
  <meta name="theme-color" data-light="#e4e4e7" data-dark="#27272a" content="#e4e4e7" />
  <link rel="icon" type="image/x-icon" sizes="16x16" href="https://blog.moxuetianya.com/favicon.ico" />
  <link rel="apple-touch-icon" type="image/png" href="https://blog.moxuetianya.com/apple-touch-icon.png?h=58bee300054c5308feb3" />
  <link rel="icon" type="image/png" href="https://blog.moxuetianya.com/android-icon.png?h=8d80ec95446bd2c36826" />
  <script src="https://blog.moxuetianya.com/js/linkita.min.js?h=1dd3ed42fc674277bc34"></script>
  <script src="https://blog.moxuetianya.com/js/linkita-search.min.js?h=698547b4b081d012c661"></script>
  <!-- Begin Head End inject -->
  
  <!-- End Head End inject -->
</head>

<body class="text-black duration-100 ease-out bg-[var(--bg)] dark:text-white">
  <!-- Header -->
<header class="bg-[var(--header)] fixed top-0 z-40 mx-auto min-h-[3.25rem] w-full header-icons">
  <div class="mx-auto w-full max-w-4xl p-2.5 lg:flex lg:justify-between">
    <div class="flex justify-between">
      <div class="flex items-center min-h-8">
        <button type="button" title="Go to home page" accesskey="!"
          onclick="window.location.href='https://blog.moxuetianya.com/';"
          class="btn-home h-6 w-6 shrink-0 cursor-pointer text-[0] bg-center bg-no-repeat bg-cover [background-image:var(--icon-home)] dark:invert"
        ></button>
        <button type="button" title="Switch color scheme" accesskey="$"
          onclick="window.linkita.toggleDarkMode();" ondblclick="window.linkita.resetDarkMode();"
          class="btn-dark ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0] bg-center bg-no-repeat bg-cover dark:invert [background-image:var(--icon-theme-dark)] dark:[background-image:var(--icon-theme-light)]"
        ></button>
        <button type="button" title="Search" accesskey="/"
          onclick="window.linkita.toggleSearch();"
          class="btn-search ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0] bg-center bg-no-repeat bg-cover [background-image:var(--icon-search)] dark:invert"
        ></button>
        <script>window.linkita.initSearchButton({ scripts: ["https://blog.moxuetianya.com/elasticlunr.min.js", "https://blog.moxuetianya.com/search_index.en.js"] });</script>
      </div>
    </div>
  </div>
</header>

  <!-- Begin Body Start inject -->
  
  <!-- End Body Start inject -->
  <main class="prose prose-neutral relative mx-auto min-h-[calc(100%-4rem)]
    max-w-3xl break-words px-4 pb-12 pt-28 lg:pt-32 dark:prose-invert prose-pre:rounded-lg prose-img:rounded-lg">
      <!-- Search -->
<div id="linkita-search-wrapper" class="hidden">
  <ul id="linkita-search-results"></ul>
</div>

    
<article>
  <!-- Begin Page Start inject -->
  
  <!-- End Page Start inject -->

  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">apt download下载离线安装包</h1>
    <!-- Page Info -->
<div class="text-sm antialiased opacity-80"><time
      datetime="2025-10-23T13:29:40+08:00">2025-10-23</time><span
        class="mx-1">&middot;</span><time
    datetime="PT0H3M0S">3&nbsp;min</time>
</div>

  </header>
  <!-- TOC -->
<div class="block-bg mb-12 rounded-lg p-2 text-lg">
  <details>
    <summary class="select-none py-0.5 lg:py-1 pl-4" accesskey="=">
      <span class="cursor-pointer">Table of Contents</span>
    </summary>
    <div class="px-2">
      <ul>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#fang-an-yi-yum-apt-xia-zai-chi-xian-bao-tui-jian-xin-shou">方案一：yum &#x2F; apt 下载离线包（推荐新手）</a>
          <ul>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#centos-rhel-xia-zai-rpm-bao">CentOS &#x2F; RHEL（下载 rpm 包）</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#nei-wang-ji-qi-an-zhuang">========== 内网机器安装 ==========</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#ubuntu-debian-xia-zai-deb-bao">Ubuntu &#x2F; Debian（下载 deb 包）</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#nei-wang-ji-qi-an-zhuang-1">========== 内网机器安装 ==========</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#opensuse-suse-xia-zai-rpm-bao">openSUSE &#x2F; SUSE（下载 rpm 包）</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#nei-wang-ji-qi-an-zhuang-2">========== 内网机器安装 ==========</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#alpine-linux-xia-zai-apk-bao">Alpine Linux（下载 apk 包）</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#nei-wang-ji-qi-an-zhuang-3">========== 内网机器安装 ==========</a>
            </li>
          </ul>
        </li>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#fang-an-er-tong-bu-wan-zheng-cang-ku-gua-he-da-gui-mo-nei-wang-huan-jing">方案二：同步完整仓库（适合大规模内网环境）</a>
          <ul>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#centos-shi-yong-reposync-tong-bu-cang-ku">CentOS 使用 reposync 同步仓库</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#nei-wang-ji-qi-pei-zhi-ben-di-cang-ku">========== 内网机器配置本地仓库 ==========</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#ubuntu-shi-yong-apt-mirror-tong-bu-cang-ku">Ubuntu 使用 apt-mirror 同步仓库</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#nei-wang-ji-qi-pei-zhi-ben-di-yuan">========== 内网机器配置本地源 ==========</a>
            </li>
          </ul>
        </li>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#fang-an-san-rong-qi-jing-xiang-chi-xian-dao-ru-gua-he-rong-qi-hua-ying-yong">方案三：容器镜像离线导入（适合容器化应用）</a>
          <ul>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#lian-wang-ji-qi-cao-zuo">========== 联网机器操作 ==========</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#nei-wang-ji-qi-cao-zuo">========== 内网机器操作 ==========</a>
            </li>
          </ul>
        </li>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#chang-jian-wen-ti-pai-cha">常见问题排查</a>
          <ul>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#wen-ti-1-yi-lai-bao-ban-ben-chong-tu">问题1：依赖包版本冲突</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#wen-ti-2-nei-wang-ji-qi-xi-tong-ban-ben-he-lian-wang-ji-qi-bu-yi-zhi">问题2：内网机器系统版本和联网机器不一致</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#wen-ti-3-xia-zai-de-bao-bu-quan-an-zhuang-shi-huan-shi-ti-shi-que-yi-lai">问题3：下载的包不全，安装时还是提示缺依赖</a>
            </li>
          </ul>
        </li>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/10/apt download下载离线安装包/#shi-yong-ji-qiao-zong-jie">实用技巧总结</a>
        </li>
      </ul>
    </div>
  </details>
</div>

  <!-- Content -->
  <section><h1 id="fang-an-yi-yum-apt-xia-zai-chi-xian-bao-tui-jian-xin-shou">方案一：yum / apt 下载离线包（推荐新手）</h1>
<h2 id="centos-rhel-xia-zai-rpm-bao">CentOS / RHEL（下载 rpm 包）</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 首先安装 yum-plugin-downloadonly 插件
</span><span style="color:#bf616a;">yum</span><span> install yum-plugin-downloadonly</span><span style="color:#bf616a;"> -y
</span><span style="color:#65737e;"># 使用下面命令下载指定的包及其依赖项
</span><span style="color:#bf616a;">yum</span><span> install</span><span style="color:#bf616a;"> --downloadonly</span><span> 软件包名
</span><span style="color:#65737e;"># 例如：下载nginx
</span><span style="color:#bf616a;">yum</span><span> install</span><span style="color:#bf616a;"> --downloadonly</span><span> nginx
</span><span style="color:#65737e;"># 默认下载路径
</span><span style="color:#bf616a;">ll</span><span> /var/cache/yum/x86_64/7/base/packages
</span><span style="color:#bf616a;">ll</span><span> /var/cache/yum/x86_64/7/epel/packages
</span><span style="color:#65737e;"># 指定下载路径（推荐）
</span><span style="color:#bf616a;">yum</span><span> install</span><span style="color:#bf616a;"> --downloadonly --downloaddir</span><span>=/data/pkgs/nginx/ nginx
</span><span style="color:#65737e;"># 参数解释
</span><span style="color:#bf616a;">--downloadonly                          </span><span style="color:#65737e;"># 只下载包不安装
</span><span style="color:#bf616a;">--downloaddir</span><span>=</span><span style="color:#a3be8c;">/your/custom/path/        </span><span style="color:#65737e;"># 指定下载路径
</span><span style="color:#65737e;"># 查看下载后的包
</span><span style="color:#bf616a;">ls</span><span> /data/pkgs/nginx/
</span><span style="color:#65737e;"># centos-indexhtml-7-9.el7.centos.noarch.rpm
</span><span style="color:#65737e;"># gperftools-libs-2.6.1-1.el7.x86_64.rpm
</span><span style="color:#65737e;"># nginx-1.20.1-10.el7.x86_64.rpm
</span><span style="color:#65737e;"># nginx-filesystem-1.20.1-10.el7.noarch.rpm
</span><span style="color:#65737e;"># openssl11-libs-1.1.1k-7.el7.x86_64.rpm
</span><span style="color:#65737e;"># 打包传输到内网
</span><span style="color:#96b5b4;">cd</span><span> /data/pkgs/
</span><span style="color:#bf616a;">tar -czf</span><span> nginx-offline.tar.gz nginx/
</span></code></pre>
<h2 id="nei-wang-ji-qi-an-zhuang">========== 内网机器安装 ==========</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 解压后进入目录
</span><span style="color:#bf616a;">tar -xzf</span><span> nginx-offline.tar.gz
</span><span style="color:#96b5b4;">cd</span><span> nginx/
</span><span style="color:#65737e;"># 方法1：使用rpm命令
</span><span style="color:#bf616a;">rpm -ivh </span><span>*.rpm
</span><span style="color:#65737e;"># 方法2：使用yum localinstall（推荐，自动处理依赖）
</span><span style="color:#bf616a;">yum</span><span> localinstall</span><span style="color:#bf616a;"> -y </span><span>*.rpm
</span></code></pre>
<h2 id="ubuntu-debian-xia-zai-deb-bao">Ubuntu / Debian（下载 deb 包）</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 下载deb包
</span><span style="color:#bf616a;">apt --download-only</span><span> install 软件包名
</span><span style="color:#65737e;"># 例如：下载nginx
</span><span style="color:#bf616a;">apt --download-only</span><span> install nginx
</span><span style="color:#65737e;"># 默认下载路径
</span><span style="color:#bf616a;">ll</span><span> /var/cache/apt/archives/
</span><span style="color:#65737e;"># 指定下载路径
</span><span style="color:#bf616a;">mkdir -p</span><span> /data/pkgs/nginx
</span><span style="color:#bf616a;">apt -o</span><span> dir::cache::archives=&quot;</span><span style="color:#a3be8c;">/data/pkgs/nginx</span><span>&quot; install</span><span style="color:#bf616a;"> --download-only</span><span> nginx
</span><span style="color:#65737e;"># 参数解释
</span><span style="color:#bf616a;">--download-only                                    </span><span style="color:#65737e;"># 只下载包不安装
</span><span style="color:#bf616a;">-o</span><span> dir::cache::archives=&quot;</span><span style="color:#a3be8c;">/your/custom/path</span><span>&quot;       </span><span style="color:#65737e;"># 指定下载路径
</span><span style="color:#65737e;"># 打包传输
</span><span style="color:#96b5b4;">cd</span><span> /data/pkgs/
</span><span style="color:#bf616a;">tar -czf</span><span> nginx-offline.tar.gz nginx/
</span></code></pre>
<h2 id="nei-wang-ji-qi-an-zhuang-1">========== 内网机器安装 ==========</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">tar -xzf</span><span> nginx-offline.tar.gz
</span><span style="color:#96b5b4;">cd</span><span> nginx/
</span><span style="color:#65737e;"># 安装所有deb包
</span><span style="color:#bf616a;">dpkg -i </span><span>*.deb
</span><span style="color:#65737e;"># 如果遇到依赖问题，执行
</span><span style="color:#bf616a;">apt</span><span> install</span><span style="color:#bf616a;"> -f
</span></code></pre>
<h2 id="opensuse-suse-xia-zai-rpm-bao">openSUSE / SUSE（下载 rpm 包）</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 下载包及依赖
</span><span style="color:#bf616a;">zypper</span><span> install</span><span style="color:#bf616a;"> --download-only</span><span> 软件包名
</span><span style="color:#65737e;"># 例如：下载nginx
</span><span style="color:#bf616a;">zypper</span><span> install</span><span style="color:#bf616a;"> --download-only</span><span> nginx
</span><span style="color:#65737e;"># 默认下载路径
</span><span style="color:#bf616a;">ll</span><span> /var/cache/zypp/packages/
</span><span style="color:#65737e;"># 指定下载目录
</span><span style="color:#bf616a;">zypper --pkg-cache-dir</span><span>=/data/pkgs/nginx install</span><span style="color:#bf616a;"> --download-only</span><span> nginx
</span></code></pre>
<h2 id="nei-wang-ji-qi-an-zhuang-2">========== 内网机器安装 ==========</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#96b5b4;">cd</span><span> /data/pkgs/nginx/
</span><span style="color:#bf616a;">rpm -ivh </span><span>*.rpm
</span><span style="color:#65737e;"># 或
</span><span style="color:#bf616a;">zypper</span><span> install</span><span style="color:#bf616a;"> --no-refresh </span><span>*.rpm
</span></code></pre>
<h2 id="alpine-linux-xia-zai-apk-bao">Alpine Linux（下载 apk 包）</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 下载包到指定目录
</span><span style="color:#bf616a;">apk</span><span> fetch</span><span style="color:#bf616a;"> --recursive --output</span><span> /data/pkgs/nginx/ nginx
</span><span style="color:#65737e;"># 参数解释
</span><span style="color:#bf616a;">--recursive    </span><span style="color:#65737e;"># 下载所有依赖
</span><span style="color:#bf616a;">--output       </span><span style="color:#65737e;"># 指定输出目录
</span></code></pre>
<h2 id="nei-wang-ji-qi-an-zhuang-3">========== 内网机器安装 ==========</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#96b5b4;">cd</span><span> /data/pkgs/nginx/
</span><span style="color:#bf616a;">apk</span><span> add</span><span style="color:#bf616a;"> --allow-untrusted </span><span>*.apk
</span></code></pre>
<h1 id="fang-an-er-tong-bu-wan-zheng-cang-ku-gua-he-da-gui-mo-nei-wang-huan-jing">方案二：同步完整仓库（适合大规模内网环境）</h1>
<p>如果内网机器很多，每次都手动下载包太麻烦。可以搭建本地 yum/apt 仓库。</p>
<h2 id="centos-shi-yong-reposync-tong-bu-cang-ku">CentOS 使用 reposync 同步仓库</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 安装同步工具
</span><span style="color:#bf616a;">yum</span><span> install yum-utils createrepo</span><span style="color:#bf616a;"> -y
</span><span style="color:#65737e;"># 同步base仓库（根据需要选择仓库）
</span><span style="color:#bf616a;">reposync -r</span><span> base</span><span style="color:#bf616a;"> -p</span><span> /data/local-repo/
</span><span style="color:#65737e;"># 同步epel仓库
</span><span style="color:#bf616a;">reposync -r</span><span> epel</span><span style="color:#bf616a;"> -p</span><span> /data/local-repo/
</span><span style="color:#65737e;"># 创建仓库元数据
</span><span style="color:#bf616a;">createrepo</span><span> /data/local-repo/base/
</span><span style="color:#bf616a;">createrepo</span><span> /data/local-repo/epel/
</span><span style="color:#65737e;"># 打包传输到内网
</span><span style="color:#96b5b4;">cd</span><span> /data/
</span><span style="color:#bf616a;">tar -czf</span><span> local-repo.tar.gz local-repo/
</span></code></pre>
<h2 id="nei-wang-ji-qi-pei-zhi-ben-di-cang-ku">========== 内网机器配置本地仓库 ==========</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 解压仓库文件
</span><span style="color:#bf616a;">tar -xzf</span><span> local-repo.tar.gz</span><span style="color:#bf616a;"> -C</span><span> /data/
</span><span style="color:#65737e;"># 配置yum源
</span><span style="color:#bf616a;">cat </span><span>&gt; /etc/yum.repos.d/local.repo &lt;&lt;</span><span style="color:#b48ead;">EOF
</span><span style="color:#a3be8c;">[local-base]
</span><span style="color:#a3be8c;">name=Local Base Repository
</span><span style="color:#a3be8c;">baseurl=file:///data/local-repo/base
</span><span style="color:#a3be8c;">enabled=1
</span><span style="color:#a3be8c;">gpgcheck=0
</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">[local-epel]
</span><span style="color:#a3be8c;">name=Local EPEL Repository
</span><span style="color:#a3be8c;">baseurl=file:///data/local-repo/epel
</span><span style="color:#a3be8c;">enabled=1
</span><span style="color:#a3be8c;">gpgcheck=0
</span><span style="color:#b48ead;">EOF
</span><span>
</span><span style="color:#65737e;"># 清理缓存并测试
</span><span style="color:#bf616a;">yum</span><span> clean all
</span><span style="color:#bf616a;">yum</span><span> makecache
</span><span style="color:#bf616a;">yum</span><span> repolist
</span></code></pre>
<h2 id="ubuntu-shi-yong-apt-mirror-tong-bu-cang-ku">Ubuntu 使用 apt-mirror 同步仓库</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 安装同步工具
</span><span style="color:#bf616a;">apt</span><span> install apt-mirror</span><span style="color:#bf616a;"> -y
</span><span>
</span><span style="color:#65737e;"># 编辑配置文件
</span><span style="color:#bf616a;">vim</span><span> /etc/apt/mirror.list
</span><span style="color:#65737e;"># 修改内容如下：
</span><span style="color:#96b5b4;">set</span><span> base_path    /data/apt-mirror
</span><span style="color:#bf616a;">deb</span><span> http://mirrors.aliyun.com/ubuntu focal main restricted universe multiverse
</span><span style="color:#bf616a;">deb</span><span> http://mirrors.aliyun.com/ubuntu focal-updates main restricted universe multiverse
</span><span>
</span><span style="color:#65737e;"># 开始同步（注意：完整同步需要很大空间，100GB+）
</span><span style="color:#bf616a;">apt-mirror
</span><span>
</span><span style="color:#65737e;"># 打包核心部分传输到内网
</span><span style="color:#96b5b4;">cd</span><span> /data/apt-mirror/mirror/mirrors.aliyun.com/
</span><span style="color:#bf616a;">tar -czf</span><span> ubuntu-repo.tar.gz ubuntu/
</span></code></pre>
<h2 id="nei-wang-ji-qi-pei-zhi-ben-di-yuan">========== 内网机器配置本地源 ==========</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 配置本地源
</span><span style="color:#bf616a;">cat </span><span>&gt; /etc/apt/sources.list &lt;&lt;</span><span style="color:#b48ead;">EOF
</span><span style="color:#a3be8c;">deb [trusted=yes] file:///data/ubuntu-repo focal main restricted universe multiverse
</span><span style="color:#a3be8c;">deb [trusted=yes] file:///data/ubuntu-repo focal-updates main restricted universe multiverse
</span><span style="color:#b48ead;">EOF
</span><span>
</span><span style="color:#65737e;"># 更新并测试
</span><span style="color:#bf616a;">apt</span><span> update
</span></code></pre>
<h1 id="fang-an-san-rong-qi-jing-xiang-chi-xian-dao-ru-gua-he-rong-qi-hua-ying-yong">方案三：容器镜像离线导入（适合容器化应用）</h1>
<h2 id="lian-wang-ji-qi-cao-zuo">========== 联网机器操作 ==========</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 拉取镜像
</span><span style="color:#bf616a;">docker</span><span> pull nginx:latest
</span><span style="color:#bf616a;">docker</span><span> pull mysql:8.0
</span><span>
</span><span style="color:#65737e;"># 导出镜像为tar文件
</span><span style="color:#bf616a;">docker</span><span> save nginx:latest</span><span style="color:#bf616a;"> -o</span><span> nginx-latest.tar
</span><span style="color:#bf616a;">docker</span><span> save mysql:8.0</span><span style="color:#bf616a;"> -o</span><span> mysql-8.0.tar
</span><span>
</span><span style="color:#65737e;"># 或批量导出
</span><span style="color:#bf616a;">docker</span><span> save $(</span><span style="color:#bf616a;">docker</span><span> images</span><span style="color:#bf616a;"> -q</span><span>)</span><span style="color:#bf616a;"> -o</span><span> all-images.tar
</span></code></pre>
<h2 id="nei-wang-ji-qi-cao-zuo">========== 内网机器操作 ==========</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 导入镜像
</span><span style="color:#bf616a;">docker</span><span> load</span><span style="color:#bf616a;"> -i</span><span> nginx-latest.tar
</span><span style="color:#bf616a;">docker</span><span> load</span><span style="color:#bf616a;"> -i</span><span> mysql-8.0.tar
</span><span>
</span><span style="color:#65737e;"># 查看导入的镜像
</span><span style="color:#bf616a;">docker</span><span> images
</span><span>
</span><span style="color:#65737e;"># 使用镜像
</span><span style="color:#bf616a;">docker</span><span> run</span><span style="color:#bf616a;"> -d -p</span><span> 80:80 nginx:latest
</span></code></pre>
<h1 id="chang-jian-wen-ti-pai-cha">常见问题排查</h1>
<h2 id="wen-ti-1-yi-lai-bao-ban-ben-chong-tu">问题1：依赖包版本冲突</h2>
<ul>
<li>症状：安装时提示依赖版本不匹配</li>
<li>解决：强制安装或降级</li>
</ul>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">rpm -ivh --force --nodeps</span><span> xxx.rpm  </span><span style="color:#65737e;"># 不推荐，可能导致系统问题
</span><span style="color:#65737e;"># 更好的办法：在联网机器上模拟内网环境再下载
</span><span style="color:#bf616a;">yum --installroot</span><span>=/data/test-env install nginx
</span></code></pre>
<h2 id="wen-ti-2-nei-wang-ji-qi-xi-tong-ban-ben-he-lian-wang-ji-qi-bu-yi-zhi">问题2：内网机器系统版本和联网机器不一致</h2>
<ul>
<li>症状：下载的包在内网无法安装</li>
<li>解决：确保两边系统版本一致</li>
</ul>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">cat</span><span> /etc/os-release  </span><span style="color:#65737e;"># 查看系统版本
</span><span style="color:#65737e;"># 或者使用Docker容器模拟相同环境下载
</span><span style="color:#bf616a;">docker</span><span> run</span><span style="color:#bf616a;"> -it --rm -v</span><span> /data/pkgs:/pkgs centos:7 bash
</span><span style="color:#bf616a;">yum</span><span> install</span><span style="color:#bf616a;"> --downloadonly --downloaddir</span><span>=/pkgs/nginx nginx
</span></code></pre>
<h2 id="wen-ti-3-xia-zai-de-bao-bu-quan-an-zhuang-shi-huan-shi-ti-shi-que-yi-lai">问题3：下载的包不全，安装时还是提示缺依赖</h2>
<ul>
<li>原因：可能是内网机器已安装的包版本和下载的依赖不匹配</li>
<li>解决：使用 yumdownloader 下载所有依赖</li>
</ul>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">yum</span><span> install yum-utils</span><span style="color:#bf616a;"> -y
</span><span style="color:#bf616a;">yumdownloader --resolve --destdir</span><span>=/data/pkgs/nginx nginx
</span><span>
</span><span style="color:#65737e;"># 参数解释
</span><span style="color:#bf616a;">--resolve    </span><span style="color:#65737e;"># 解析并下载所有依赖
</span><span style="color:#bf616a;">--destdir    </span><span style="color:#65737e;"># 指定下载目录
</span></code></pre>
<h1 id="shi-yong-ji-qiao-zong-jie">实用技巧总结</h1>
<ol>
<li>模拟内网环境下载</li>
</ol>
<ul>
<li>在联网机器上创建和内网相同的干净环境</li>
</ul>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">docker</span><span> run</span><span style="color:#bf616a;"> -it --rm -v</span><span> /data:/data centos:7 bash
</span></code></pre>
<ul>
<li>在容器内下载，确保依赖准确</li>
</ul>
<ol start="2">
<li>批量下载多个软件</li>
</ol>
<ul>
<li>创建软件列表</li>
</ul>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">cat </span><span>&gt; software-list.txt &lt;&lt;</span><span style="color:#b48ead;">EOF
</span><span style="color:#a3be8c;">nginx
</span><span style="color:#a3be8c;">mysql-server
</span><span style="color:#a3be8c;">git
</span><span style="color:#a3be8c;">vim
</span><span style="color:#b48ead;">EOF
</span></code></pre>
<ul>
<li>批量下载</li>
</ul>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#b48ead;">while </span><span style="color:#96b5b4;">read</span><span> pkg; </span><span style="color:#b48ead;">do
</span><span>  </span><span style="color:#bf616a;">yum</span><span> install</span><span style="color:#bf616a;"> --downloadonly --downloaddir</span><span>=/data/pkgs/$</span><span style="color:#bf616a;">pkg </span><span>$</span><span style="color:#bf616a;">pkg
</span><span style="color:#b48ead;">done </span><span>&lt; software-list.txt
</span></code></pre>
<ol start="3">
<li>检查下载是否完整</li>
</ol>
<ul>
<li>列出所有rpm包及依赖关系</li>
</ul>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">rpm -qpR</span><span> /data/pkgs/nginx/*.rpm
</span></code></pre>
<p><a href="https://mp.weixin.qq.com/s/bmTND8Se398a1XdB4J5YYA?poc_token=HIi8-WijPaouTTo4Dbrcz5nkTRaeCJf5j-M5tgnw">转载地址</a></p>
</section>
  <hr />
  <!-- Post Taxonomies -->
<footer class="mt-12 flex flex-col" tabindex="-1" accesskey="_">
  <div class="mb-2 flex flex-wrap">
    <span class="block-bg mb-1.5 mr-1.5 rounded-lg px-5 py-1.5">Tags</span>
    
    <a
      class="block-bg block-hover mb-1.5 mr-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://blog.moxuetianya.com/tags/apt/">apt</a>
    
  </div>
</footer>

  <!-- Post Nav -->
<nav class="block-bg mt-12 flex flex-wrap rounded-lg text-lg">
  <a
    class="block-hover-mask flex min-w-[50%] grow items-center rounded-l-md p-6 pr-3 font-semibold no-underline"
    href="https://blog.moxuetianya.com/2025/10/常用软件列表/" accesskey=","
    ><span class="mr-1.5">&#8249;</span><span>常用软件列表</span></a>
  <a
    class="block-hover-mask ml-auto flex min-w-[50%] grow items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline"
    href="https://blog.moxuetianya.com/2025/10/linux bios刷新工具fwupd/" accesskey="."
    ><span>linux bios刷新工具fwupd</span><span class="ml-1.5">&#8250;</span></a>
</nav>

  <!-- Begin Page End inject -->
  
  <!-- End Page End inject -->
</article>

  </main>
  <!-- Footer -->
<footer class="mx-auto flex lg:mt-5 max-w-3xl flex-wrap items-center px-4 py-3 text-sm opacity-60">
  <div class="mr-auto basis-full lg:basis-1/2">
  © <time datetime="2025">2025</time> moxuetianya
  </div>
  <div class="flex basis-full lg:basis-1/2 lg:justify-end">
    <span class="mr-6 lg:ml-6">
      <a class="link" href="https://www.getzola.org/" target="_blank">Powered by Zola</a>
    </span>
    <a class="link" href="https://www.getzola.org/themes/linkita/" target="_blank">&#9998; Linkita</a>
  </div>
  <!-- Begin Footer inject -->
  
  <!-- End Footer inject -->
</footer>

  

  <!-- Begin Body End inject -->
  
  <!-- End Body End inject -->
</body>

</html>
