<!doctype html>
<html class="not-ready lg:text-base overflow-y-scroll scroll-pt-14" lang="en">

<head prefix="og: https://ogp.me/ns# article: https://ogp.me/ns/article#">
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="generator" content="Zola" />
  <title>制作iso启动镜像</title>
  <meta property="og:title" content="制作iso启动镜像" />
  <meta property="og:url" content="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/" />
  <link rel="canonical" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-12-08T17:03:21+08:00" />
  <meta property="article:tag" content="iso" />
  <!-- Begin Head inject -->
  
  <!-- End Head inject -->
  <link rel="stylesheet" href="https://blog.moxuetianya.com/main.min.css?h=fc65ba308cf36d3ba82c" />
  <style>
  :root{--bg: #f4f4f5; --header: #e4e4e7; color-scheme: light;}
  :root.dark{--bg: #18181b; --header: #27272a; color-scheme: dark;}
  </style>
  <meta name="theme-color" data-light="#e4e4e7" data-dark="#27272a" content="#e4e4e7" />
  <link rel="icon" type="image/x-icon" sizes="16x16" href="https://blog.moxuetianya.com/favicon.ico" />
  <link rel="apple-touch-icon" type="image/png" href="https://blog.moxuetianya.com/apple-touch-icon.png?h=58bee300054c5308feb3" />
  <link rel="icon" type="image/png" href="https://blog.moxuetianya.com/android-icon.png?h=8d80ec95446bd2c36826" />
  <script src="https://blog.moxuetianya.com/js/linkita.min.js?h=1dd3ed42fc674277bc34"></script>
  <script src="https://blog.moxuetianya.com/js/linkita-search.min.js?h=698547b4b081d012c661"></script>
  <!-- Begin Head End inject -->
  
  <!-- End Head End inject -->
</head>

<body class="text-black duration-100 ease-out bg-[var(--bg)] dark:text-white">
  <!-- Header -->
<header class="bg-[var(--header)] fixed top-0 z-40 mx-auto min-h-[3.25rem] w-full header-icons">
  <div class="mx-auto w-full max-w-4xl p-2.5 lg:flex lg:justify-between">
    <div class="flex justify-between">
      <div class="flex items-center min-h-8">
        <button type="button" title="Go to home page" accesskey="!"
          onclick="window.location.href='https://blog.moxuetianya.com/';"
          class="btn-home h-6 w-6 shrink-0 cursor-pointer text-[0] bg-center bg-no-repeat bg-cover [background-image:var(--icon-home)] dark:invert"
        ></button>
        <button type="button" title="Switch color scheme" accesskey="$"
          onclick="window.linkita.toggleDarkMode();" ondblclick="window.linkita.resetDarkMode();"
          class="btn-dark ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0] bg-center bg-no-repeat bg-cover dark:invert [background-image:var(--icon-theme-dark)] dark:[background-image:var(--icon-theme-light)]"
        ></button>
        <button type="button" title="Search" accesskey="/"
          onclick="window.linkita.toggleSearch();"
          class="btn-search ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0] bg-center bg-no-repeat bg-cover [background-image:var(--icon-search)] dark:invert"
        ></button>
        <script>window.linkita.initSearchButton({ scripts: ["https://blog.moxuetianya.com/elasticlunr.min.js", "https://blog.moxuetianya.com/search_index.en.js"] });</script>
      </div>
    </div>
  </div>
</header>

  <!-- Begin Body Start inject -->
  
  <!-- End Body Start inject -->
  <main class="prose prose-neutral relative mx-auto min-h-[calc(100%-4rem)]
    max-w-3xl break-words px-4 pb-12 pt-28 lg:pt-32 dark:prose-invert prose-pre:rounded-lg prose-img:rounded-lg">
      <!-- Search -->
<div id="linkita-search-wrapper" class="hidden">
  <ul id="linkita-search-results"></ul>
</div>

    
<article>
  <!-- Begin Page Start inject -->
  
  <!-- End Page Start inject -->

  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">制作iso启动镜像</h1>
    <!-- Page Info -->
<div class="text-sm antialiased opacity-80"><time
      datetime="2025-12-08T17:03:21+08:00">2025-12-08</time><span
        class="mx-1">&middot;</span><time
    datetime="PT0H1M0S">1&nbsp;min</time>
</div>

  </header>
  <!-- TOC -->
<div class="block-bg mb-12 rounded-lg p-2 text-lg">
  <details>
    <summary class="select-none py-0.5 lg:py-1 pl-4" accesskey="=">
      <span class="cursor-pointer">Table of Contents</span>
    </summary>
    <div class="px-2">
      <ul>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#shi-yong-lb-buildji-yu-debianshang-you-zhi-zuo-ni-de-linuxfa-xing-ban">使用lb-build基于Debian上游制作你的Linux发行版</a>
        </li>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#shi-yong-ben-di-xi-tong-huo-debootstrapgou-jian-zui-xiao-gen-wen-jian-xi-tong">使用本地系统或debootstrap构建最小根文件系统</a>
          <ul>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#an-zhuang-gong-ju-yu-zhun-bei-huan-jing">安装工具与准备环境</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#gou-jian-zui-xiao-gen-wen-jian-xi-tong">构建最小根文件系统</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#zhi-zuo-squashfs-zuo-wei-live-xi-tong-root">制作 squashfs（作为 live 系统 root）</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#pei-zhi-qing-dan">配置清单</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#uefiyin-dao-grub-efi">UEFI引导(grub-efi)</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#sheng-cheng-ke-qi-dong-iso">生成可启动ISO</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#ke-xuan-jia-ru-ni-de-an-zhuang-jiao-ben-zi-ding-yi-installer">（可选）：加入你的“安装脚本”（自定义 installer）</a>
            </li>
            <li>
              <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#ce-shi-yan-zheng">测试验证</a>
            </li>
          </ul>
        </li>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#diao-shi-pai-cha">调试排查</a>
        </li>
        <li>
          <a class="no-underline hover:underline" href="https://blog.moxuetianya.com/2025/12/制作iso启动镜像/#debian-guan-fang-de-mini-live-zhi-zuo-liu-cheng">Debian 官方的 mini live 制作流程</a>
        </li>
      </ul>
    </div>
  </details>
</div>

  <!-- Content -->
  <section><h1 id="shi-yong-lb-buildji-yu-debianshang-you-zhi-zuo-ni-de-linuxfa-xing-ban">使用lb-build基于Debian上游制作你的Linux发行版</h1>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">apt</span><span> install live-build
</span><span style="color:#bf616a;">mkdir</span><span> TestOS
</span><span style="color:#96b5b4;">cd</span><span> TestOS
</span><span>
</span><span style="color:#65737e;"># Ubuntu 系统的 live-build 会自动注入 Ubuntu 默认包： 使用debian环境构建
</span><span style="color:#bf616a;">podman</span><span> pull debian:bookworm
</span><span style="color:#bf616a;">podman</span><span> run</span><span style="color:#bf616a;"> --privileged -it --rm -v</span><span>./:/build/ debian:bookworm bash
</span><span>
</span><span style="color:#bf616a;">sudo</span><span> sed</span><span style="color:#bf616a;"> -i </span><span>&#39;</span><span style="color:#a3be8c;">s/deb.debian.org/mirrors.ustc.edu.cn/g</span><span>&#39; /etc/apt/sources.list.d/debian.sources
</span><span style="color:#bf616a;">apt</span><span> update
</span><span style="color:#bf616a;">apt</span><span> install</span><span style="color:#bf616a;"> -y</span><span> live-build debootstrap debian-archive-keyring
</span><span style="color:#96b5b4;">cd</span><span> /build/
</span><span>
</span><span style="color:#bf616a;">sudo</span><span> lb clean</span><span style="color:#bf616a;"> --purge
</span><span style="color:#bf616a;">sudo</span><span> rm config chroot cache</span><span style="color:#bf616a;"> -rf
</span><span style="color:#bf616a;">lb</span><span> config \
</span><span style="color:#bf616a;">  --distribution</span><span> bookworm \
</span><span style="color:#bf616a;">  --archive-areas </span><span>&quot;</span><span style="color:#a3be8c;">main contrib non-free non-free-firmware</span><span>&quot; \
</span><span style="color:#bf616a;">  --mirror-bootstrap</span><span> https://mirrors.ustc.edu.cn/debian/ \
</span><span style="color:#bf616a;">  --mirror-chroot</span><span> https://mirrors.ustc.edu.cn/debian/ \
</span><span style="color:#bf616a;">  --mirror-chroot-security</span><span> https://mirrors.ustc.edu.cn/debian-security/ \
</span><span style="color:#bf616a;">  --mirror-binary-security</span><span> https://mirrors.ustc.edu.cn/debian-security \
</span><span style="color:#bf616a;">  --mirror-debian-installer</span><span> https://mirrors.ustc.edu.cn/debian \
</span><span style="color:#bf616a;">  --security</span><span> true
</span><span>
</span><span style="color:#bf616a;">sudo</span><span> lb build
</span><span>
</span><span style="color:#bf616a;">xorriso -as</span><span> cdrecord</span><span style="color:#bf616a;"> -v</span><span> dev=/dev/sr0 Blank=as_needed ./live-image-amd64.hybrid.iso
</span><span style="color:#bf616a;">dd</span><span> if=./live-image-amd64.hybrid.iso of=/dev/sdb bs=64M conv=fsync status=progress
</span><span>
</span><span style="color:#bf616a;">aptitude</span><span> search &#39;</span><span style="color:#a3be8c;">~prequired|~pimportant</span><span>&#39;
</span></code></pre>
<p><a href="https://zhuanlan.zhihu.com/p/643461882">参考教程</a></p>
<h1 id="shi-yong-ben-di-xi-tong-huo-debootstrapgou-jian-zui-xiao-gen-wen-jian-xi-tong">使用本地系统或debootstrap构建最小根文件系统</h1>
<h2 id="an-zhuang-gong-ju-yu-zhun-bei-huan-jing">安装工具与准备环境</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 安装核心工具
</span><span style="color:#bf616a;">sudo</span><span> apt update
</span><span style="color:#bf616a;">sudo</span><span> apt install debootstrap squashfs-tools xorriso grub-pc-bin grub-efi-amd64-bin isolinux
</span><span style="color:#65737e;"># sudo apt install syslinux-utils mtools genisoimage rsync
</span><span>
</span><span style="color:#65737e;"># 创建工作目录
</span><span style="color:#bf616a;">mkdir ~</span><span>/debian-custom-iso &amp;&amp; </span><span style="color:#96b5b4;">cd </span><span style="color:#bf616a;">~</span><span>/debian-custom-iso
</span><span style="color:#bf616a;">mkdir</span><span> rootfs iso
</span></code></pre>
<h2 id="gou-jian-zui-xiao-gen-wen-jian-xi-tong">构建最小根文件系统</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 假设构建Debian 12 (Bookworm) 系统
</span><span style="color:#bf616a;">sudo</span><span> debootstrap</span><span style="color:#bf616a;"> --verbose --arch</span><span>=amd64 bookworm ./rootfs http://deb.debian.org/debian
</span><span style="color:#65737e;"># 进入新系统进行基本配置
</span><span style="color:#bf616a;">sudo</span><span> mount</span><span style="color:#bf616a;"> -t</span><span> proc proc rootfs/proc
</span><span style="color:#bf616a;">sudo</span><span> mount</span><span style="color:#bf616a;"> --rbind</span><span> /sys rootfs/sys
</span><span style="color:#bf616a;">sudo</span><span> mount</span><span style="color:#bf616a;"> --rbind</span><span> /dev rootfs/dev
</span><span style="color:#bf616a;">sudo</span><span> chroot ./rootfs /bin/bash
</span><span style="color:#65737e;"># 在chroot环境中执行以下命令
</span><span style="color:#65737e;"># 1. 安装一些最基础的软件和内核
</span><span style="color:#bf616a;">apt</span><span> update
</span><span style="color:#bf616a;">apt</span><span> install</span><span style="color:#bf616a;"> --no-install-recommends</span><span> linux-image-amd64 systemd-sysv passwd
</span><span style="color:#bf616a;">apt</span><span> install live-boot live-config
</span><span style="color:#65737e;"># grub-pc-bin grub-efi-amd64 grub-efi-amd64-bin parted dosfstools openssh-server
</span><span style="color:#65737e;"># 2. 设置root密码（重要，否则可能无法登录）
</span><span style="color:#96b5b4;">echo</span><span> custom-debian &gt; /etc/hostname
</span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">127.0.1.1 custom-debian</span><span>&quot; &gt;&gt; /etc/hosts
</span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">root:root</span><span>&quot; | </span><span style="color:#bf616a;">chpasswd
</span><span style="color:#65737e;"># 3. 配置网络（基础DHCP）
</span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">auto eth0</span><span>&quot; &gt;&gt; /etc/network/interfaces.d/eth0
</span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">iface eth0 inet dhcp</span><span>&quot; &gt;&gt; /etc/network/interfaces.d/eth0
</span><span style="color:#65737e;"># 4. 退出chroot环境
</span><span style="color:#96b5b4;">exit
</span><span style="color:#bf616a;">sudo</span><span> umount</span><span style="color:#bf616a;"> -l</span><span> rootfs/{proc,sys,dev}
</span></code></pre>
<h2 id="zhi-zuo-squashfs-zuo-wei-live-xi-tong-root">制作 squashfs（作为 live 系统 root）</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># sudo apt install live-boot live-config
</span><span style="color:#bf616a;">chroot</span><span> rootfs apt install live-boot live-config
</span><span style="color:#bf616a;">chroot</span><span> rootfs update-initramfs</span><span style="color:#bf616a;"> -u
</span><span>
</span><span style="color:#bf616a;">mkdir -p</span><span> iso/live
</span><span style="color:#bf616a;">sudo</span><span> mksquashfs rootfs iso/live/filesystem.squashfs</span><span style="color:#bf616a;"> -comp</span><span> xz</span><span style="color:#bf616a;"> -wildcards
</span><span style="color:#bf616a;">cp</span><span> rootfs/boot/vmlinuz-* iso/live/vmlinuz
</span><span style="color:#bf616a;">cp</span><span> rootfs/boot/initrd.img-* iso/live/initrd.img
</span></code></pre>
<h2 id="pei-zhi-qing-dan">配置清单</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">mkdir</span><span> iso/isolinux/
</span><span style="color:#bf616a;">cp</span><span> /usr/lib/ISOLINUX/isolinux.bin iso/isolinux/
</span><span style="color:#bf616a;">cp</span><span> /usr/lib/syslinux/modules/bios/ldlinux.c32 iso/isolinux/
</span><span>
</span><span style="color:#bf616a;">cat </span><span>&gt; iso/isolinux/isolinux.cfg &lt;&lt;</span><span style="color:#b48ead;">EOF
</span><span style="color:#a3be8c;">DEFAULT install
</span><span style="color:#a3be8c;">TIMEOUT 3
</span><span style="color:#a3be8c;">PROMPT 1
</span><span style="color:#a3be8c;">LABEL install
</span><span style="color:#a3be8c;">  SAY Booting custom Debian live system...
</span><span style="color:#a3be8c;">  MENU LABEL ^Install Debian (text mode)
</span><span style="color:#a3be8c;">  KERNEL /live/vmlinuz
</span><span style="color:#a3be8c;">  APPEND vga=788 initrd=/live/initrd.img boot=live quiet rd.debug 
</span><span style="color:#b48ead;">EOF
</span></code></pre>
<h2 id="uefiyin-dao-grub-efi">UEFI引导(grub-efi)</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">mkdir -p</span><span> iso/EFI/BOOT iso/boot/grub
</span><span style="color:#bf616a;">cp</span><span> /usr/lib/grub/x86_64-efi/monolithic/grubx64.efi iso/EFI/BOOT/BOOTX64.EFI
</span><span>
</span><span>
</span><span style="color:#65737e;"># 创建GRUB配置文件 (iso/boot/grub/grub.cfg)
</span><span style="color:#bf616a;">cat </span><span>&gt; iso/boot/grub/grub.cfg &lt;&lt; &#39;</span><span style="color:#b48ead;">EOF</span><span>&#39;
</span><span style="color:#a3be8c;">set timeout=5
</span><span style="color:#a3be8c;">menuentry &quot;Custom Debian Live&quot; {
</span><span style="color:#a3be8c;">    linux /live/vmlinuz boot=live quiet
</span><span style="color:#a3be8c;">    initrd /live/initrd.img
</span><span style="color:#a3be8c;">}
</span><span style="color:#b48ead;">EOF
</span></code></pre>
<h2 id="sheng-cheng-ke-qi-dong-iso">生成可启动ISO</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 注意！！！ 相对ISO 内路径是 /isolinux/isolinux.bin
</span><span style="color:#65737e;"># 注意！！！ 相对ISO 内路径是 /EFI/BOOT/BOOTX64.EFI
</span><span style="color:#bf616a;">xorriso -as</span><span> mkisofs \
</span><span style="color:#bf616a;">  -o</span><span> debian-custom.iso \
</span><span style="color:#bf616a;">  -iso-level</span><span> 3 \
</span><span style="color:#bf616a;">  -full-iso9660-filenames </span><span>\
</span><span style="color:#bf616a;">  -volid </span><span>&quot;</span><span style="color:#a3be8c;">CUSTOM_DEBIAN</span><span>&quot; \
</span><span style="color:#bf616a;">  -eltorito-boot</span><span> isolinux/isolinux.bin \
</span><span style="color:#bf616a;">  -eltorito-catalog</span><span> isolinux/boot.cat \
</span><span style="color:#bf616a;">  -no-emul-boot -boot-load-size</span><span> 4</span><span style="color:#bf616a;"> -boot-info-table </span><span>\
</span><span style="color:#bf616a;">  -eltorito-alt-boot </span><span>\
</span><span style="color:#bf616a;">  -e</span><span> EFI/BOOT/BOOTX64.EFI \
</span><span style="color:#bf616a;">  -no-emul-boot </span><span>\
</span><span>  iso/
</span></code></pre>
<h2 id="ke-xuan-jia-ru-ni-de-an-zhuang-jiao-ben-zi-ding-yi-installer">（可选）：加入你的“安装脚本”（自定义 installer）</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 你自己的安装脚本可以把 rootfs 安装进真实硬盘：
</span><span style="color:#65737e;"># 你就拥有了一个 完全自己定制的 Debian 安装 ISO。
</span><span style="color:#bf616a;">cat </span><span>&gt; iso/install.sh &lt;&lt;</span><span style="color:#b48ead;">EOF
</span><span style="color:#a3be8c;">mkfs.ext4 /dev/sda1
</span><span style="color:#a3be8c;">mount /dev/sda1 /mnt
</span><span style="color:#a3be8c;">unsquashfs -f -d /mnt /live/filesystem.squashfs
</span><span style="color:#a3be8c;">grub-install /dev/sda
</span><span style="color:#a3be8c;">update-grub
</span><span style="color:#b48ead;">EOF
</span><span>
</span><span style="color:#bf616a;">cat </span><span>&gt;&gt; grub.cfg &lt;&lt;</span><span style="color:#b48ead;">EOF
</span><span style="color:#a3be8c;">menuentry &quot;Run installer&quot; {
</span><span style="color:#a3be8c;">    linux /live/vmlinuz boot=live autoexec=/install.sh
</span><span style="color:#a3be8c;">    initrd /live/initrd.img
</span><span style="color:#a3be8c;">}
</span><span style="color:#b48ead;">EOF
</span></code></pre>
<h2 id="ce-shi-yan-zheng">测试验证</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># bios
</span><span style="color:#bf616a;">qemu-system-x86_64 -m</span><span> 1024</span><span style="color:#bf616a;"> -cdrom</span><span> debian-custom.iso</span><span style="color:#bf616a;"> -boot</span><span> d</span><span style="color:#bf616a;"> -enable-kvm
</span><span>
</span><span style="color:#65737e;"># uefi 启动
</span><span style="color:#bf616a;">sudo</span><span> apt install ovmf
</span><span style="color:#bf616a;">qemu-system-x86_64 -m</span><span> 1024 \
</span><span style="color:#bf616a;">-bios</span><span> /usr/share/OVMF/OVMF.fd \
</span><span style="color:#bf616a;">-cdrom</span><span> debian-custom.iso \
</span><span style="color:#bf616a;">-boot</span><span> d</span><span style="color:#bf616a;"> -enable-kvm
</span><span>
</span><span style="color:#65737e;"># 可 dd 到 U 盘
</span><span style="color:#bf616a;">sudo</span><span> dd if=debian-custom.iso of=/dev/sdX bs=4M status=progress
</span></code></pre>
<h1 id="diao-shi-pai-cha">调试排查</h1>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">xorriso -indev</span><span> debian-custom.iso</span><span style="color:#bf616a;"> -ls </span><span>| </span><span style="color:#bf616a;">grep -i </span><span>&#39;</span><span style="color:#a3be8c;">initrd\|vmlinuz</span><span>&#39;
</span><span style="color:#bf616a;">mkdir</span><span> /tmp/iso
</span><span style="color:#bf616a;">sudo</span><span> mount</span><span style="color:#bf616a;"> -o</span><span> loop debian-custom.iso /tmp/iso
</span><span style="color:#bf616a;">find</span><span> /tmp/iso</span><span style="color:#bf616a;"> -name </span><span>&quot;</span><span style="color:#a3be8c;">*initrd*</span><span>&quot;</span><span style="color:#bf616a;"> -o -name </span><span>&quot;</span><span style="color:#a3be8c;">*vmlinuz*</span><span>&quot; </span><span style="color:#d08770;">2</span><span>&gt;/dev/null
</span><span style="color:#bf616a;">sudo</span><span> umount /tmp/iso
</span><span style="color:#bf616a;">xorriso -indev</span><span> debian-custom.iso</span><span style="color:#bf616a;"> -extract </span><span>&#39;</span><span style="color:#a3be8c;">/isolinux/isolinux.cfg</span><span>&#39; /tmp/isolinux.cfg </span><span style="color:#d08770;">2</span><span>&gt;/dev/null || </span><span style="color:#bf616a;">true
</span><span style="color:#bf616a;">xorriso -indev</span><span> debian-custom.iso</span><span style="color:#bf616a;"> -extract </span><span>&#39;</span><span style="color:#a3be8c;">/boot/grub/grub.cfg</span><span>&#39; /tmp/grub.cfg </span><span style="color:#d08770;">2</span><span>&gt;/dev/null || </span><span style="color:#bf616a;">true
</span><span>
</span><span style="color:#bf616a;">cat</span><span> /tmp/isolinux.cfg /tmp/grub.cfg </span><span style="color:#d08770;">2</span><span>&gt;/dev/null | </span><span style="color:#bf616a;">grep -A1 -B1 </span><span>&#39;</span><span style="color:#a3be8c;">initrd\|vmlinuz</span><span>&#39;
</span><span>
</span><span style="color:#bf616a;">mkdir</span><span> /tmp/initrd
</span><span style="color:#96b5b4;">cd</span><span> /tmp/initrd
</span><span style="color:#bf616a;">zcat</span><span> /tmp/iso/live/initrd.img | </span><span style="color:#bf616a;">cpio -idmv
</span></code></pre>
<h1 id="debian-guan-fang-de-mini-live-zhi-zuo-liu-cheng">Debian 官方的 mini live 制作流程</h1>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># chroot 内安装 live-boot + rebuild initrd
</span><span style="color:#bf616a;">chroot</span><span> rootfs apt update
</span><span style="color:#bf616a;">chroot</span><span> rootfs apt install</span><span style="color:#bf616a;"> --no-install-recommends</span><span> live-boot live-config systemd-sysv linux-image-amd64
</span><span style="color:#bf616a;">chroot</span><span> rootfs update-initramfs</span><span style="color:#bf616a;"> -u
</span><span>
</span><span style="color:#65737e;"># ISOLINUX 目录结构
</span><span style="color:#bf616a;">mkdir -p</span><span> iso/isolinux
</span><span style="color:#bf616a;">cp</span><span> /usr/lib/ISOLINUX/isolinux.bin iso/isolinux/
</span><span style="color:#bf616a;">cp</span><span> /usr/lib/syslinux/modules/bios/*.c32 iso/isolinux/
</span><span>
</span><span style="color:#65737e;"># 创建 UEFI FAT ESP
</span><span style="color:#bf616a;">mkdir -p</span><span> iso/efi-img
</span><span style="color:#bf616a;">mkdir -p</span><span> esp/EFI/BOOT
</span><span style="color:#bf616a;">cp</span><span> /usr/lib/grub/x86_64-efi/monolithic/grubx64.efi esp/EFI/BOOT/BOOTX64.EFI
</span><span>
</span><span style="color:#65737e;"># 制作 FAT 镜像
</span><span style="color:#bf616a;">dd</span><span> if=/dev/zero of=iso/efi.img bs=1M count=10
</span><span style="color:#bf616a;">mkfs.vfat</span><span> iso/efi.img
</span><span style="color:#bf616a;">mcopy -i</span><span> iso/efi.img</span><span style="color:#bf616a;"> -s</span><span> esp/* ::/
</span><span>
</span><span style="color:#65737e;"># xorriso 构建正确的混合引导 ISO
</span><span style="color:#bf616a;">xorriso -as</span><span> mkisofs \
</span><span style="color:#bf616a;">  -o</span><span> debian-custom.iso \
</span><span style="color:#bf616a;">  -iso-level</span><span> 3 \
</span><span style="color:#bf616a;">  -full-iso9660-filenames </span><span>\
</span><span style="color:#bf616a;">  -eltorito-boot</span><span> isolinux/isolinux.bin \
</span><span style="color:#bf616a;">    -eltorito-catalog</span><span> isolinux/boot.cat \
</span><span style="color:#bf616a;">    -no-emul-boot -boot-load-size</span><span> 4</span><span style="color:#bf616a;"> -boot-info-table </span><span>\
</span><span style="color:#bf616a;">  -eltorito-alt-boot </span><span>\
</span><span style="color:#bf616a;">    -e</span><span> efi.img \
</span><span style="color:#bf616a;">    -no-emul-boot </span><span>\
</span><span style="color:#bf616a;">  -append_partition</span><span> 2 0xef iso/efi.img \
</span><span>  iso/
</span></code></pre>
</section>
  <hr />
  <!-- Post Taxonomies -->
<footer class="mt-12 flex flex-col" tabindex="-1" accesskey="_">
  <div class="mb-2 flex flex-wrap">
    <span class="block-bg mb-1.5 mr-1.5 rounded-lg px-5 py-1.5">Tags</span>
    
    <a
      class="block-bg block-hover mb-1.5 mr-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://blog.moxuetianya.com/tags/iso/">iso</a>
    
  </div>
</footer>

  <!-- Post Nav -->
<nav class="block-bg mt-12 flex flex-wrap rounded-lg text-lg">
  <a
    class="block-hover-mask flex min-w-[50%] grow items-center rounded-l-md p-6 pr-3 font-semibold no-underline"
    href="https://blog.moxuetianya.com/2025/12/linux 中ntfs自动挂载/" accesskey=","
    ><span class="mr-1.5">&#8249;</span><span>linux 中ntfs自动挂载</span></a>
  <a
    class="block-hover-mask ml-auto flex min-w-[50%] grow items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline"
    href="https://blog.moxuetianya.com/2025/12/apt本地仓库/" accesskey="."
    ><span>apt本地仓库</span><span class="ml-1.5">&#8250;</span></a>
</nav>

  <!-- Begin Page End inject -->
  
  <!-- End Page End inject -->
</article>

  </main>
  <!-- Footer -->
<footer class="mx-auto flex lg:mt-5 max-w-3xl flex-wrap items-center px-4 py-3 text-sm opacity-60">
  <div class="mr-auto basis-full lg:basis-1/2">
  © <time datetime="2025">2025</time> moxuetianya
  </div>
  <div class="flex basis-full lg:basis-1/2 lg:justify-end">
    <span class="mr-6 lg:ml-6">
      <a class="link" href="https://www.getzola.org/" target="_blank">Powered by Zola</a>
    </span>
    <a class="link" href="https://www.getzola.org/themes/linkita/" target="_blank">&#9998; Linkita</a>
  </div>
  <!-- Begin Footer inject -->
  
  <!-- End Footer inject -->
</footer>

  

  <!-- Begin Body End inject -->
  
  <!-- End Body End inject -->
</body>

</html>
